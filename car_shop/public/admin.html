<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<title>Admin</title>

<style>
body {
  background:#0e0e0e;
  color:white;
  font-family:-apple-system;
  padding:16px;
}
.card {
  background:#1a1a1a;
  border-radius:14px;
  padding:12px;
  margin-bottom:12px;
}
input, button {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:none;
}
button {
  background:#2ea6ff;
  color:white;
}
.delete {
  background:#ff4d4d;
}
</style>
</head>
<body>

<h2>üõ† cp_nobal ‚Ä¢ store</h2>
<div id="list"></div>

<script>
const tg = Telegram.WebApp;
tg.expand();

fetch("/products")
.then(r=>r.json())
.then(data=>{
  const box = document.getElementById("list");
  data.forEach(p=>{
    box.innerHTML += `
      <div class="card">
        <input value="${p.title}" id="t${p.id}">
        <input value="${p.price}" id="p${p.id}">
        <button onclick="edit('${p.id}')">‚úèÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="delete" onclick="del('${p.id}')">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
      </div>
    `;
  });
});

function edit(id){
  const form = new FormData();
  form.append("id", id);
  form.append("title", document.getElementById("t"+id).value);
  form.append("price", document.getElementById("p"+id).value);

  fetch("/edit-product", {
    method:"POST",
    headers:{ "x-telegram-init-data": tg.initData },
    body: form
  }).then(()=>alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ"));
}

function del(id){
  if(!confirm("–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?")) return;

  const form = new FormData();
  form.append("id", id);

  fetch("/delete-product", {
    method:"POST",
    headers:{ "x-telegram-init-data": tg.initData },
    body: form
  }).then(()=>location.reload());
}
</script>
</body>
</html>
